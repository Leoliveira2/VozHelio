<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Modificador de Voz - Hélio e Outros</title>
  <style>
    body { font-family: sans-serif; background: #eef2f3; text-align: center; padding: 30px; }
    h1 { margin-bottom: 20px; font-size: 24px; }
    button { padding: 12px 20px; margin: 10px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; }
    #record { background: #007bff; color: white; }
    #stop { background: #dc3545; color: white; }
    .effect { background: #28a745; color: white; }
  </style>
</head>
<body>

<h1>🎙️ Modificador de Voz</h1>

<button id="record">🎤 Gravar</button>
<button id="stop" disabled>🛑 Parar</button>

<div id="effects" style="display:none;">
  <p><strong>Efeitos:</strong></p>
  <button class="effect" onclick="playEffect('normal')">▶️ Original</button>
  <button class="effect" onclick="playEffect('helium')">🎈 Hélio</button>
  <button class="effect" onclick="playEffect('deep')">💀 Grave</button>
  <button class="effect" onclick="playEffect('robot')">🤖 Robô</button>
  <button class="effect" onclick="playEffect('echo')">🌌 Eco</button>
</div>

<script>
let mediaRecorder, audioChunks = [], audioBlob, audioBuffer;
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

document.getElementById('record').onclick = async () => {
  audioChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.start();

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

  mediaRecorder.onstop = async () => {
    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
    const arrayBuffer = await audioBlob.arrayBuffer();
    audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
    document.getElementById('effects').style.display = 'block';
  };

  document.getElementById('record').disabled = true;
  document.getElementById('stop').disabled = false;
};

document.getElementById('stop').onclick = () => {
  mediaRecorder.stop();
  document.getElementById('record').disabled = false;
  document.getElementById('stop').disabled = true;
};

function playEffect(effectType) {
  if (!audioBuffer) return;

  const source = audioCtx.createBufferSource();
  source.buffer = audioBuffer;
  let node = source;

  switch (effectType) {
    case 'helium':
      source.playbackRate.value = 1.7;
      break;

    case 'deep':
      source.playbackRate.value = 0.6;
      break;

    case 'robot': {
      const gain = audioCtx.createGain();
      const osc = audioCtx.createOscillator();
      osc.frequency.value = 100;
      osc.connect(gain.gain);
      osc.start();
      node.connect(gain);
      node = gain;
      break;
    }

    case 'echo': {
      const delay = audioCtx.createDelay();
      delay.delayTime.value = 0.25;
      const feedback = audioCtx.createGain();
      feedback.gain.value = 0.4;
      delay.connect(feedback);
      feedback.connect(delay);
      node.connect(delay);
      node = delay;
      break;
    }

    case 'normal':
    default:
      source.playbackRate.value = 1.0;
      break;
  }

  node.connect(audioCtx.destination);
  source.start();
}
</script>

</body>
</html>
