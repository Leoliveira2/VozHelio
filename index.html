<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Modificador de Voz</title>
  <style>
    body { font-family: sans-serif; background: #f0f4f8; text-align: center; padding: 30px; }
    h1 { font-size: 24px; margin-bottom: 20px; }
    button { padding: 10px 20px; margin: 10px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; }
    #record { background: #007bff; color: white; }
    #stop { background: #dc3545; color: white; }
    .effect { background: #28a745; color: white; }
    audio { margin-top: 20px; }
  </style>
</head>
<body>

<h1>üéôÔ∏è Modificador de Voz: H√©lio, Grave, Rob√¥, Eco</h1>

<button id="record">Gravar</button>
<button id="stop" disabled>Parar</button>

<div id="effects" style="display:none;">
  <button class="effect" onclick="playEffect('normal')">‚ñ∂Ô∏è Original</button>
  <button class="effect" onclick="playEffect('helium')">üéà H√©lio</button>
  <button class="effect" onclick="playEffect('deep')">üíÄ Grave</button>
  <button class="effect" onclick="playEffect('robot')">ü§ñ Rob√¥</button>
  <button class="effect" onclick="playEffect('echo')">üåå Eco</button>
</div>

<audio id="player" controls style="display:none;"></audio>

<script>
let mediaRecorder, audioChunks = [], audioBlob, audioBuffer;
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();
const player = document.getElementById('player');

document.getElementById('record').onclick = async () => {
  audioChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.start();
  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.onstop = async () => {
    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
    const arrayBuffer = await audioBlob.arrayBuffer();
    audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
    player.src = URL.createObjectURL(audioBlob);
    player.style.display = 'block';
    document.getElementById('effects').style.display = 'block';
  };
  document.getElementById('record').disabled = true;
  document.getElementById('stop').disabled = false;
};

document.getElementById('stop').onclick = () => {
  mediaRecorder.stop();
  document.getElementById('record').disabled = false;
  document.getElementById('stop').disabled = true;
};

function playEffect(type) {
  const source = audioCtx.createBufferSource();
  source.buffer = audioBuffer;

  let effectChain = source;

  switch (type) {
    case 'helium':
      source.playbackRate.value = 1.7;
      break;

    case 'deep':
      source.playbackRate.value = 0.6;
      break;

    case 'robot': {
      const ringMod = audioCtx.createGain();
      const osc = audioCtx.createOscillator();
      osc.frequency.value = 90;
      osc.connect(ringMod.gain);
      osc.start();
      effectChain.connect(ringMod);
      effectChain = ringMod;
      break;
    }

    case 'echo': {
      const delay = audioCtx.createDelay();
      delay.delayTime.value = 0.3;
      const feedback = audioCtx.createGain();
      feedback.gain.value = 0.4;
      delay.connect(feedback);
      feedback.connect(delay);
      effectChain.connect(delay);
      effectChain = delay;
      break;
    }

    case 'normal':
    default:
      source.playbackRate.value = 1;
      break;
  }

  effectChain.connect(audioCtx.destination);
  source.start();
}
</script>

</body>
</html>
